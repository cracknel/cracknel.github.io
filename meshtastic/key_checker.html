<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meshtastic Low Entropy Key Checker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .warning-box {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 5px solid #ff6b6b;
        }

        .warning-box h3 {
            color: #d63031;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .warning-box p {
            color: #2d3436;
            line-height: 1.5;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .input-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            resize: vertical;
            min-height: 120px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
        }

        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: rgba(255, 255, 255, 1);
        }

        .btn-check {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-check:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-check:active {
            transform: translateY(0);
        }

        .btn-check:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            margin-top: 25px;
            padding: 20px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            text-align: center;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(10px);
        }

        .result.show {
            opacity: 1;
            transform: translateY(0);
        }

        .result.safe {
            background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%);
            color: #27ae60;
            border-left: 5px solid #27ae60;
        }

        .result.unsafe {
            background: linear-gradient(135deg, #ffb3ba 0%, #ffdfba 100%);
            color: #e74c3c;
            border-left: 5px solid #e74c3c;
        }

        .result.error {
            background: linear-gradient(135deg, #ffd93d 0%, #ff9a9e 100%);
            color: #f39c12;
            border-left: 5px solid #f39c12;
        }

        .info-box {
            background: rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
            border-left: 5px solid #667eea;
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .info-box a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .info-box a:hover {
            text-decoration: underline;
        }

        .icon {
            font-size: 1.2em;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .checking {
            animation: pulse 1.5s infinite;
        }

        @media (max-width: 768px) {
            .container {
                padding: 25px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê Meshtastic Key Checker</h1>
            <p>Check if your Meshtastic public key is one of the known low entropy keys</p>
        </div>

        <div class="warning-box">
            <h3><span class="icon">‚ö†Ô∏è</span> Security Notice</h3>
            <p>If your key is identified as low entropy, it means your key is one of the 20 known compromised keys from the official firmware. Consider regenerating your keys immediately to maintain message security.</p>
        </div>

        <form id="keyForm">
            <div class="input-group">
                <label for="publicKey">Base64 Encoded Public Key:</label>
                <textarea 
                    id="publicKey" 
                    name="publicKey" 
                    placeholder="Enter your base64 encoded Meshtastic public key here...&#10;Example: aBcDeFgHiJkLmNoPqRsTuVwXyZ0123456789+/aBcDeFg="
                    required></textarea>
            </div>
            <button type="submit" class="btn-check" id="checkBtn">
                <span id="btnText">Check Key Security</span>
            </button>
        </form>

        <div id="result" class="result"></div>

        <div class="info-box">
            <h3>üìã How This Works</h3>
            <p>This tool implements the same low entropy key detection algorithm used in Meshtastic firmware v2.6.11+:</p>
            <p>‚Ä¢ Your public key is decoded from base64</p>
            <p>‚Ä¢ The key is hashed using SHA-256</p>
            <p>‚Ä¢ The hash is compared against all 20 known compromised key hashes</p>
            <p>‚Ä¢ Based on the <a href="https://github.com/meshtastic/firmware/blob/master/src/mesh/NodeDB.h" target="_blank">official Meshtastic firmware source</a></p>
        </div>
    </div>

    <script>
        // Known low entropy key hashes from Meshtastic firmware
        // These are SHA-256 hashes of known compromised public keys
        // Source: https://github.com/meshtastic/firmware/blob/master/src/mesh/NodeDB.h
        const LOW_ENTROPY_HASHES = [
            // LOW_ENTROPY_HASH1
            [0xf4, 0x7e, 0xcc, 0x17, 0xe6, 0xb4, 0xa3, 0x22, 0xec, 0xee, 0xd9, 0x08, 0x4f, 0x39, 0x63, 0xea, 0x80, 0x75, 0xe1, 0x24, 0xce, 0x05, 0x36, 0x69, 0x63, 0xb2, 0xcb, 0xc0, 0x28, 0xd3, 0x34, 0x8b],
            // LOW_ENTROPY_HASH2
            [0x5a, 0x9e, 0xa2, 0xa6, 0x8a, 0xa6, 0x66, 0xc1, 0x5f, 0x55, 0x00, 0x64, 0xa3, 0xa6, 0xfe, 0x71, 0xc0, 0xbb, 0x82, 0xc3, 0x32, 0x3d, 0x7a, 0x7a, 0xe3, 0x6e, 0xfd, 0xdd, 0xad, 0x3a, 0x66, 0xb9],
            // LOW_ENTROPY_HASH3
            [0xb3, 0xdf, 0x3b, 0x2e, 0x67, 0xb6, 0xd5, 0xf8, 0xdf, 0x76, 0x2c, 0x45, 0x5e, 0x2e, 0xbd, 0x16, 0xc5, 0xf8, 0x67, 0xaa, 0x15, 0xf8, 0x92, 0x0b, 0xdf, 0x5a, 0x66, 0x50, 0xac, 0x0d, 0xbb, 0x2f],
            // LOW_ENTROPY_HASH4
            [0x3b, 0x8f, 0x86, 0x3a, 0x38, 0x1f, 0x77, 0x39, 0xa9, 0x4e, 0xef, 0x91, 0x18, 0x5a, 0x62, 0xe1, 0xaa, 0x9d, 0x36, 0xea, 0xce, 0x60, 0x35, 0x8d, 0x9d, 0x1f, 0xf4, 0xb8, 0xc9, 0x13, 0x6a, 0x5d],
            // LOW_ENTROPY_HASH5
            [0x36, 0x7e, 0x2d, 0xe1, 0x84, 0x5f, 0x42, 0x52, 0x29, 0x11, 0x0a, 0x25, 0x64, 0x54, 0x6a, 0x6b, 0xfd, 0xb6, 0x65, 0xff, 0x15, 0x1a, 0x51, 0x71, 0x22, 0x40, 0x57, 0xf6, 0x91, 0x9b, 0x64, 0x58],
            // LOW_ENTROPY_HASH6
            [0x16, 0x77, 0xeb, 0xa4, 0x52, 0x91, 0xfb, 0x26, 0xcf, 0x8f, 0xd7, 0xd9, 0xd1, 0x5d, 0xc4, 0x68, 0x73, 0x75, 0xed, 0xc5, 0x95, 0x58, 0xee, 0x90, 0x56, 0xd4, 0x2f, 0x31, 0x29, 0xf7, 0x8c, 0x1f],
            // LOW_ENTROPY_HASH7
            [0x31, 0x8c, 0xa9, 0x5e, 0xed, 0x3c, 0x12, 0xbf, 0x97, 0x9c, 0x47, 0x8e, 0x98, 0x9d, 0xc2, 0x3e, 0x86, 0x23, 0x90, 0x29, 0xc8, 0xb0, 0x20, 0xf8, 0xb1, 0xb0, 0xaa, 0x19, 0x2a, 0xcf, 0x0a, 0x54],
            // LOW_ENTROPY_HASH8
            [0xa4, 0x8a, 0x99, 0x0e, 0x51, 0xdc, 0x12, 0x20, 0xf3, 0x13, 0xf5, 0x2b, 0x3a, 0xe2, 0x43, 0x42, 0xc6, 0x52, 0x98, 0xcd, 0xbb, 0xca, 0xb1, 0x31, 0xa0, 0xd4, 0xd6, 0x30, 0xf3, 0x27, 0xfb, 0x49],
            // LOW_ENTROPY_HASH9
            [0xd2, 0x3f, 0x13, 0x8d, 0x22, 0x04, 0x8d, 0x07, 0x59, 0x58, 0xa0, 0xf9, 0x55, 0xcf, 0x30, 0xa0, 0x2e, 0x2f, 0xca, 0x80, 0x20, 0xe4, 0xde, 0xa1, 0xad, 0xd9, 0x58, 0xb3, 0x43, 0x2b, 0x22, 0x70],
            // LOW_ENTROPY_HASH10
            [0x40, 0x41, 0xec, 0x6a, 0xd2, 0xd6, 0x03, 0xe4, 0x9a, 0x9e, 0xbd, 0x6c, 0x0a, 0x9b, 0x75, 0xa4, 0xbc, 0xab, 0x6f, 0xa7, 0x95, 0xff, 0x2d, 0xf6, 0xe9, 0xb9, 0xab, 0x4c, 0x0c, 0x1c, 0xd0, 0x3b],
            // LOW_ENTROPY_HASH11
            [0x22, 0x49, 0x32, 0x2b, 0x00, 0xf9, 0x22, 0xfa, 0x17, 0x02, 0xe9, 0x64, 0x82, 0xf0, 0x4d, 0x1b, 0xc7, 0x04, 0xfc, 0xdc, 0x8c, 0x5e, 0xb6, 0xd9, 0x16, 0xd6, 0x37, 0xce, 0x59, 0xaa, 0x09, 0x49],
            // LOW_ENTROPY_HASH12
            [0x48, 0x6f, 0x1e, 0x48, 0x97, 0x88, 0x64, 0xac, 0xe8, 0xeb, 0x30, 0xa3, 0xc3, 0xe1, 0xcf, 0x97, 0x39, 0xa6, 0x55, 0x5b, 0x5f, 0xbf, 0x18, 0xb7, 0x3a, 0xdf, 0xa8, 0x75, 0xe7, 0x9d, 0xe0, 0x1e],
            // LOW_ENTROPY_HASH13
            [0x09, 0xb4, 0xe2, 0x6d, 0x28, 0x98, 0xc9, 0x47, 0x66, 0x46, 0xbf, 0xff, 0x58, 0x17, 0x91, 0xaa, 0xc3, 0xbf, 0x4a, 0x9d, 0x0b, 0x88, 0xb1, 0xf1, 0x03, 0xdd, 0x61, 0xd7, 0xba, 0x9e, 0x64, 0x98],
            // LOW_ENTROPY_HASH14
            [0x39, 0x39, 0x84, 0xe0, 0x22, 0x2f, 0x7d, 0x78, 0x45, 0x18, 0x72, 0xb4, 0x13, 0xd2, 0x01, 0x2f, 0x3c, 0xa1, 0xb0, 0xfe, 0x39, 0xd0, 0xf1, 0x3c, 0x72, 0xd6, 0xef, 0x54, 0xd5, 0x77, 0x22, 0xa0],
            // LOW_ENTROPY_HASH15
            [0x0a, 0xda, 0x5f, 0xec, 0xff, 0x5c, 0xc0, 0x2e, 0x5f, 0xc4, 0x8d, 0x03, 0xe5, 0x80, 0x59, 0xd3, 0x5d, 0x49, 0x86, 0xe9, 0x8d, 0xf6, 0xf6, 0x16, 0x35, 0x3d, 0xf9, 0x9b, 0x29, 0x55, 0x9e, 0x64],
            // LOW_ENTROPY_HASH16
            [0x08, 0x56, 0xf0, 0xd7, 0xef, 0x77, 0xd6, 0x11, 0x1c, 0x8f, 0x95, 0x2d, 0x3c, 0xdf, 0xb1, 0x22, 0xbf, 0x60, 0x9b, 0xe5, 0xa9, 0xc0, 0x6e, 0x4b, 0x01, 0xdc, 0xd1, 0x57, 0x44, 0xb2, 0xa5, 0xcf],
            // LOW_ENTROPY_HASH17
            [0x2c, 0xb2, 0x77, 0x85, 0xd6, 0xb7, 0x48, 0x9c, 0xfe, 0xbc, 0x80, 0x26, 0x60, 0xf4, 0x6d, 0xce, 0x11, 0x31, 0xa2, 0x1e, 0x33, 0x0a, 0x6d, 0x2b, 0x00, 0xfa, 0x0c, 0x90, 0x95, 0x8f, 0x5c, 0x6b],
            // LOW_ENTROPY_HASH18
            [0xfa, 0x59, 0xc8, 0x6e, 0x94, 0xee, 0x75, 0xc9, 0x9a, 0xb0, 0xfe, 0x89, 0x36, 0x40, 0xc9, 0x99, 0x4a, 0x3b, 0xf4, 0xaa, 0x12, 0x24, 0xa2, 0x0f, 0xf9, 0xd1, 0x08, 0xcb, 0x78, 0x19, 0xaa, 0xe5],
            // LOW_ENTROPY_HASH19
            [0x6e, 0x42, 0x7a, 0x4a, 0x8c, 0x61, 0x62, 0x22, 0xa1, 0x89, 0xd3, 0xa4, 0xc2, 0x19, 0xa3, 0x83, 0x53, 0xa7, 0x7a, 0x0a, 0x89, 0xe2, 0x54, 0x52, 0x62, 0x3d, 0xe7, 0xca, 0x8c, 0xf6, 0x6a, 0x60],
            // LOW_ENTROPY_HASH20
            [0x20, 0x27, 0x2f, 0xba, 0x0c, 0x99, 0xd7, 0x29, 0xf3, 0x11, 0x35, 0x89, 0x9d, 0x0e, 0x24, 0xa1, 0xc3, 0xcb, 0xdf, 0x8a, 0xf1, 0xc6, 0xfe, 0xd0, 0xd7, 0x9f, 0x92, 0xd6, 0x8f, 0x59, 0xbf, 0xe4]
        ];

        // Convert hash arrays to hex strings for comparison
        const HASH_STRINGS = LOW_ENTROPY_HASHES.map(hash => 
            Array.from(hash).map(b => b.toString(16).padStart(2, '0')).join('')
        );

        // Base64 decode function
        function base64ToBytes(base64) {
            try {
                const binaryString = atob(base64.replace(/\s/g, ''));
                const bytes = new Uint8Array(binaryString.length);
                for (let i = 0; i < binaryString.length; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                return bytes;
            } catch (error) {
                throw new Error('Invalid base64 encoding');
            }
        }

        // SHA-256 hash function
        async function sha256(data) {
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            return new Uint8Array(hashBuffer);
        }

        // Convert bytes to hex string
        function bytesToHex(bytes) {
            return Array.from(bytes).map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // Check if key is low entropy
        async function checkLowEntropyKey(base64Key) {
            // Decode base64 to bytes
            const keyBytes = base64ToBytes(base64Key);
            
            // Validate key length (should be 32 bytes for X25519 public key)
            if (keyBytes.length !== 32) {
                throw new Error(`Invalid key length: ${keyBytes.length} bytes. Expected 32 bytes for X25519 public key.`);
            }

            // Hash the key
            const keyHash = await sha256(keyBytes);
            const keyHashHex = bytesToHex(keyHash);

            // Check against known low entropy hashes
            const isLowEntropy = HASH_STRINGS.includes(keyHashHex);

            return {
                isLowEntropy,
                keyHashHex,
                keyLength: keyBytes.length
            };
        }

        // Handle form submission
        document.getElementById('keyForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const publicKey = document.getElementById('publicKey').value.trim();
            const resultDiv = document.getElementById('result');
            const checkBtn = document.getElementById('checkBtn');
            const btnText = document.getElementById('btnText');

            if (!publicKey) {
                showResult('error', 'Please enter a public key');
                return;
            }

            // Show loading state
            checkBtn.disabled = true;
            checkBtn.classList.add('checking');
            btnText.textContent = 'Checking...';

            try {
                const result = await checkLowEntropyKey(publicKey);
                
                if (result.isLowEntropy) {
                    showResult('unsafe', 
                        `‚ö†Ô∏è COMPROMISED KEY DETECTED!<br>` +
                        `Your key matches one of the 20 known compromised keys from the official firmware. You MUST regenerate your Meshtastic keys immediately.<br>` +
                        `<small>Hash: ${result.keyHashHex.substring(0, 16)}...</small>`
                    );
                } else {
                    showResult('safe', 
                        `‚úÖ Key appears secure<br>` +
                        `Your key is not in the list of 20 known compromised keys from the official firmware.<br>` +
                        `<small>Hash: ${result.keyHashHex.substring(0, 16)}...</small>`
                    );
                }
            } catch (error) {
                showResult('error', `‚ùå Error: ${error.message}`);
            } finally {
                // Reset button state
                checkBtn.disabled = false;
                checkBtn.classList.remove('checking');
                btnText.textContent = 'Check Key Security';
            }
        });

        function showResult(type, message) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = message;
            resultDiv.classList.add('show');
        }

        // Clear result when input changes
        document.getElementById('publicKey').addEventListener('input', () => {
            const resultDiv = document.getElementById('result');
            resultDiv.classList.remove('show');
        });
    </script>
</body>
</html>